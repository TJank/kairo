generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ─── Whiteboard ──────────────────────────────────────────────────────────────

enum SectionType {
  QUOTES
  GOALS
  DREAMBOARD
  NOTES
}

model Section {
  id        String      @id @default(cuid())
  title     String
  type      SectionType @default(NOTES)
  color     String?
  order     Int         @default(0)
  fullWidth Boolean     @default(false)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  items Item[]
}

model Item {
  id          String    @id @default(cuid())
  sectionId   String
  text        String
  done        Boolean   @default(false)
  completedAt DateTime?
  dueDate     DateTime?
  order       Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  section Section @relation(fields: [sectionId], references: [id], onDelete: Cascade)

  @@index([sectionId])
}

// ─── Planner ─────────────────────────────────────────────────────────────────

enum EntryKind {
  EVENT
  TASK
}

enum Category {
  WORK
  PERSONAL
  FAMILY
}

enum Priority {
  HIGH
  MEDIUM
  LOW
}

// Work project (FE, Athenahealth, TD, etc.) to drive color + grouping.
model Project {
  id        String   @id @default(cuid())
  key       String   @unique
  name      String
  color     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  events    Event[]
  recurring RecurringEvent[]
  tasks     Task[]
}

model Event {
  id        String   @id @default(cuid())
  title     String
  notes     String?
  category  Category @default(PERSONAL)
  projectId String?
  startAt   DateTime
  endAt     DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  project Project? @relation(fields: [projectId], references: [id], onDelete: SetNull)

  @@index([startAt])
  @@index([projectId])
}

model RecurringEvent {
  id        String   @id @default(cuid())
  title     String
  notes     String?
  category  Category @default(WORK)
  projectId String?

  startDate DateTime
  startMin  Int
  endMin    Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  project Project?           @relation(fields: [projectId], references: [id], onDelete: SetNull)
  days    RecurringEventDay[]

  @@index([projectId])
}

model RecurringEventDay {
  id               String @id @default(cuid())
  recurringEventId String
  day              Int

  recurringEvent RecurringEvent @relation(fields: [recurringEventId], references: [id], onDelete: Cascade)

  @@index([recurringEventId])
}

model Task {
  id          String    @id @default(cuid())
  text        String
  notes       String?
  category    Category  @default(PERSONAL)
  projectId   String?
  priority    Priority?
  done        Boolean   @default(false)
  completedAt DateTime?

  dueAt   DateTime?
  dueDate DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  project  Project? @relation(fields: [projectId], references: [id], onDelete: SetNull)
  subtasks SubTask[]

  @@index([dueAt])
  @@index([dueDate])
  @@index([projectId])
}

model SubTask {
  id     String  @id @default(cuid())
  taskId String
  text   String
  done   Boolean @default(false)
  order  Int     @default(0)

  task Task @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([taskId])
}
